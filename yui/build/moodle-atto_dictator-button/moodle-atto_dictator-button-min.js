YUI.add("moodle-atto_dictator-button",function(e,t){var n="atto_dictator",r={ENUS:"en-US",ENUK:"en-UK",ENAU:"en-AU",FRCA:"fr-CA",ESUS:"es-US",FRFR:"fr-FR",ITIT:"it-IT",PTBR:"pt-BR"},i={},s={PLAIN:"standard",BMR:"bmr",ONETWOTHREE:"onetwothree",FRESH:"fresh",ONCE:"once"},o={AUDIO:"atto_dictator_audio",LANG_SELECT:"atto_dictator_languageselect",CP_AUDIO:"atto_dictator_audio_cont",CP_SWAP:"atto_dictator_swapmeout"},u={started:!1,currentrecorder:!1,elementid:!1},a={ROOT:'<form class="mform atto_form atto_dictator_form" id="{{elementid}}_atto_dictator_form"><div data-medium-type="{{CSS.AUDIO}}" class="tab-pane active" id="{{elementid}}_{{CSS.AUDIO}}"><div id="{{elementid}}_{{CSS.CP_AUDIO}}" class="{{CSS.CP_SWAP}}" data-id="{{elementid}}_{{CSS.CP_AUDIO}}" data-parent="{{CP.parent}}" data-appid="{{CP.appid}}" data-media="audio" data-type="{{CP.audioskin}}" data-localloader="/lib/editor/atto/plugins/dictator/poodllloader.html" data-localloading="auto" data-width="{{CP.sizes.audiowidth}}" data-height="{{CP.sizes.audioheight}}" data-transcode="0" data-speechevents="1" data-transcribe="0" data-subtitle="0" data-language="{{CP.language}}" data-expiredays="1" data-region="{{CP.region}}" data-token="{{CP.token}}" data-fallback="none"></div></div><br><label>{{get_string "speakerlanguage" component}}&nbsp;<select id="{{elementid}}_{{CSS.LANG_SELECT}}" class="{{CSS.LANG_SELECT}}"><option value="{{LANG.ENUS}}" {{#if useENUS}}selected="selected"{{/if}}>{{get_string "en-us" component}}</option><option value="{{LANG.ENUK}}" {{#if useENUK}}selected="selected"{{/if}}>{{get_string "en-uk" component}}</option><option value="{{LANG.ENAU}}" {{#if useENAU}}selected="selected"{{/if}}>{{get_string "en-au" component}}</option><option value="{{LANG.FRCA}}" {{#if useFRCA}}selected="selected"{{/if}}>{{get_string "fr-ca" component}}</option><option value="{{LANG.ESUS}}" {{#if useESUS}}selected="selected"{{/if}}>{{get_string "es-us" component}}</option><option value="{{LANG.FRFR}}" {{#if useFRFR}}selected="selected"{{/if}}>{{get_string "fr-fr" component}}</option><option value="{{LANG.ITIT}}" {{#if useITIT}}selected="selected"{{/if}}>{{get_string "it-it" component}}</option><option value="{{LANG.PTBR}}" {{#if usePTBR}}selected="selected"{{/if}}>{{get_string "pt-br" component}}</option></select></label></div></div></form>'};e.namespace("M.atto_dictator").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(e){this.addButton({icon:"audio",iconComponent:"atto_dictator",title:"audio_desc",buttonName:"audio",callback:this._displayDialogue,callbackArgs:"audio"}),i.parent=M.cfg.wwwroot,i.appid="atto_dictator",i.token=e.cp_token,i.region=e.cp_region,i.expiredays=1,i.language=e.cp_language,i.audioskin=e.cp_audioskin,i.sizes=this._fetchRecorderDimensions()},_getContext:function(t){return e.merge({elementid:this.get("host").get("elementid"),component:n,helpStrings:this.get("help"),useENUS:i.language==r.ENUS,useENUK:i.language==r.ENUK,useENAU:i.language==r.ENAU,useFRCA:i.language==r.FRCA,useESUS:i.language==r.ESUS,useFRFR:i.language==r.FRFR,useITIT:i.language==r.ITIT,usePTBR:i.language==r.PTBR,CSS:o,CP:i,LANG:r},t)},_fetchRecorderDimensions:function(){var e={};switch(i.audioskin){default:e.audiowidth=450,e.audioheight=350}return e},_displayDialogue:function(t,r){if(this.get("host").getSelection()===!1)return;this._currentSelection=this.get("host").getSelection(),u.currentrecorder=r;var s=M.util.get_string("createaudio",n),a="501",f=!1,l={};l.center=!0,l.headerContent=s,l.focusAfterHide=r,l.width=a+"px",f&&(l.height=f+"px");var c=this.getDialogue(l);c.get("width")!=a+"px"&&(c.set("headerContent",s),c.set("width",a+"px"),c.set("height",f+"px")),c.set("bodyContent",this._getDialogueContent()).show(),u.elementid=this.get("host").get("elementid"),u.languageselect=e.one("#"+u.elementid+"_"+o.LANG_SELECT);var h=e.one("#"+u.elementid+"_"+o.ATTO_DICTATOR_FORM),p=this;u.languageselect!=null&&u.languageselect.on("change",function(e){var t=e.currentTarget;t&&(i.language=t.selectedOptionValue(),h.all("."+o.CP_SWAP).setAttribute("data-language",i.language),h.all("."+o.CP_SWAP).setAttribute("data-alreadyparsed","false"),h.all("."+o.CP_SWAP).empty(),p._loadRecorders())}),this._loadRecorders()},_loadRecorders:function(){var e=this;e.inserted=!1,e.ap_count=0,require(["atto_dictator/cloudpoodllloader"],function(t){var n="",r=function(t){switch(t.type){case"speech":n+="  "+t.capturedspeech;break;case"recording":t.action==="stopped"&&(setTimeout(function(){e._doInsert(n)},1e3),e.inserted=!0);break;case"awaitingprocessing":case"filesubmitted":break;case"error":alert("PROBLEM:"+t.message)}};t.init(o.CP_SWAP,r)})},_getDialogueContent:function(t){var n=e.Node.create(e.Handlebars.compile(a.ROOT)(this._getContext()));return n},_doInsert:function(e){this.getDialogue({focusAfterHide:null}).hide();var t=this.get("host");t.focus(),t.setSelection(this._currentSelection),t.insertContentAtFocusPoint(e),this.markUpdated()}},{ATTRS:{disabled:{value:!1}}})},"@VERSION@");
